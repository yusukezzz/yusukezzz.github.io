<!DOCTYPE html>
<html lang="ja" prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb#">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<meta name="google-site-verification" content="xj9B6ZSemAAH-gdcR6nRiXCivVtsUjdYDovByJsANV8" />
<!--link rel="stylesheet" type="text/css" href="https://www.yusukezzz.net/wp-content/themes/writer/style.css" /-->
<link rel="alternate" type="application/rss+xml" title="Yusukezzz weblog &raquo; フィード" href="https://www.yusukezzz.net/feed" />
<link rel="alternate" type="application/xml" title="sitemap" href="https://www.yusukezzz.net/sitemap.xml" />
<link rel="canonical" href="https://www.yusukezzz.net/">
<title>yusukezzz weblog</title>

<!-- START - Facebook Open Graph, Google+ and Twitter Card Tags 2.0.8.2 -->
 <!-- Facebook Open Graph -->
  <meta property="og:title" content="yusukezzz weblog"/>
  <meta property="og:url" content="https://www.yusukezzz.net"/>
  <meta property="og:description" content="yusukezzz weblog"/>
 <!-- Google+ / Schema.org -->
 <!-- Twitter Cards -->
 <!-- SEO -->
 <!-- Misc. tags -->
<!-- END - Facebook Open Graph, Google+ and Twitter Card Tags 2.0.8.2 -->

</head>
<body class="home blog">
<div id="wrapper" class="hfeed">
<header id="header" role="banner">
<section id="branding">
<div id="site-title"><h1><a href="https://www.yusukezzz.net/" title="yusukezzz weblog" rel="home">yusukezzz weblog</a></h1></div>
<div id="site-description"></div>
<div><a href="https://twitter.com/yusukezzz">twitter</a> | <a href="https://github.com/yusukezzz">github</a></div>
<script>
  (function() {
    var cx = '014860011853426368546:m8rb6ucnvy4';
    var gcse = document.createElement('script');
    gcse.type = 'text/javascript';
    gcse.async = true;
    gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(gcse, s);
  })();
</script>
<gcse:search></gcse:search>
<p style="text-align: center;"><a href="https://www.vultr.com/?ref=7199493"><img src="https://www.vultr.com/media/banner_1.png" width="728" height="90"></a></p>
</section>
</header>
<div id="container"><section id="content" role="main">
<article id="post-99" class="post-99 post type-post status-publish format-standard hentry category-uncategorized tag-android tag-kotlin tag-parcelable">
<header>
<h2 class="entry-title"><a href="https://www.yusukezzz.net/archives/99" title="Kotlin の Parcelize で簡単 Parcelable 実装" rel="bookmark">Kotlin の Parcelize で簡単 Parcelable 実装</a></h2> <section class="entry-meta">
<span class="author vcard"><a href="https://www.yusukezzz.net/archives/author/yusukezzz" title="yusukezzz の投稿" rel="author">yusukezzz</a></span>
<span class="meta-sep"> | </span>
<span class="entry-date">2017-11-23</span>
</section>
</header>
<section class="entry-content">
<p>Kotlin 1.1.4 から Parcelable を手軽に実装できるようにする機能が追加された</p>
<p><a href="https://github.com/Kotlin/KEEP/blob/master/proposals/extensions/android-parcelable.md">KEEP/android&#45;parcelable&#46;md at master · Kotlin/KEEP</a></p>
<p>まだステータスは正式版ではないので gradle で</p>
<pre><code class="gradle">androidExtensions {
    experimental = true
}
</code></pre>
<p>を有効化し、</p>
<pre><code class="kotlin">@Parcelize
class MyParcelable(val data: Int): Parcelable
</code></pre>
<p>このように書いておくとコンパイル時に自動的に Parcelable 相当の実装を生成してくれる<br />
data クラスにも使用出来るので json のパース結果などを Activity 間で受け渡すのが非常に簡単になる</p>
<p>これまでは <a href="https://github.com/grandstaish/paperparcel">grandstaish/paperparcel</a> を使っていたが <code>CREATOR</code> フィールドを用意する必要がないのでより手軽だ</p>
<p>※注意<br />
CRETOR フィールドを用意する必要はないが、@Parcelize アノテーションを付与したクラスはIDE上で<br />
<code>this class implements parcelable but does not provide a CREATOR field</code><br />
というエラー扱いになる（でもコンパイルは通る）<br />
下記チケットが起票されているので、直に修正される…と思いたい<br />
<a href="https://youtrack.jetbrains.com/issue/KT-19300">&#91;AS3&#46;0&#93; Android extensions, Parcelable: editor shows warning about incomplete implementation on a class with Parcelize annotation : KT&#45;19300</a></p>
<div class="entry-links"></div>
</section>
<footer class="entry-footer">
<span class="tag-links">タグ: <a href="https://www.yusukezzz.net/archives/tag/android" rel="tag">android</a>, <a href="https://www.yusukezzz.net/archives/tag/kotlin" rel="tag">kotlin</a>, <a href="https://www.yusukezzz.net/archives/tag/parcelable" rel="tag">parcelable</a></span>
</footer> 
</article>
<article id="post-97" class="post-97 post type-post status-publish format-standard hentry category-uncategorized tag-android tag-robolectric">
<header>
<h2 class="entry-title"><a href="https://www.yusukezzz.net/archives/97" title="Android Studio 3.0 で Robolectric 関連の変更に追従" rel="bookmark">Android Studio 3.0 で Robolectric 関連の変更に追従</a></h2> <section class="entry-meta">
<span class="author vcard"><a href="https://www.yusukezzz.net/archives/author/yusukezzz" title="yusukezzz の投稿" rel="author">yusukezzz</a></span>
<span class="meta-sep"> | </span>
<span class="entry-date">2017-10-27</span>
</section>
</header>
<section class="entry-content">
<p>先日 Android Studio 3.0 が正式にリリースされたので早速ダウンロードしてビルドしたら Robolectric のテストがコケるようになってしまった<br />
<a href="http://robolectric.org/getting-started/">Getting Started &#124; Robolectric</a> に書いてある通りなのだけど以下の対応をしたら通るようになった<br />
どうやらリソースパスを解決するAPIに変更があったらしい</p>
<h3>1. testOptions の追加</h3>
<p>app/build.gradle に以下の記述を追加する</p>
<pre><code class="gradle">android {
  testOptions {
    unitTests {
      includeAndroidResources = true
    }
  }
}
</code></pre>
<h3>2. BuildConfig の指定を止める</h3>
<p>テストクラスに Robolectric の BuildConfig 指定がある場合は消す<br />
<code>@Config(constants = BuildConfig.class)</code></p>
<div class="entry-links"></div>
</section>
<footer class="entry-footer">
<span class="tag-links">タグ: <a href="https://www.yusukezzz.net/archives/tag/android" rel="tag">android</a>, <a href="https://www.yusukezzz.net/archives/tag/robolectric" rel="tag">robolectric</a></span>
</footer> 
</article>
<article id="post-92" class="post-92 post type-post status-publish format-standard hentry category-uncategorized tag-android tag-library">
<header>
<h2 class="entry-title"><a href="https://www.yusukezzz.net/archives/92" title="chrome custom tabs の warmup" rel="bookmark">chrome custom tabs の warmup</a></h2> <section class="entry-meta">
<span class="author vcard"><a href="https://www.yusukezzz.net/archives/author/yusukezzz" title="yusukezzz の投稿" rel="author">yusukezzz</a></span>
<span class="meta-sep"> | </span>
<span class="entry-date">2017-10-18</span>
</section>
</header>
<section class="entry-content">
<p>custom tabs を使う際は事前に chrome のプロセスを温めておくことで遷移を高速化出来るのだけど、自前で実装しようと思うと結構面倒くさい<br />
先人の知恵を拝借しようと Github を検索すると下記の実装が見つかった</p>
<p><a href="https://github.com/DreaminginCodeZH/CustomTabsHelper">DreaminginCodeZH/CustomTabsHelper: Custom tabs, made easy&#46;</a></p>
<p><a href="https://github.com/saschpe/android-customtabs">saschpe/android&#45;customtabs: Chrome CustomTabs for Android demystified&#46; Simplifies development and provides higher level classes including fallback in case Chrome isn&#8217;t available on device&#46;</a></p>
<p>CustomTabsHelper は Fragment を使う前提の実装で、今回自分は Fragment を使っていなかったので後者の android-customtabs を採用した<br />
使い方は非常にシンプルで README と example の通りなので省略する</p>
<p>基本的な実装はどちらも同じ、というか下記公式の customtabs 使用例が元になっていて単にアプリ（Fragment）開始時に customtabs の service に接続し、停止時に切断している<br />
<a href="https://github.com/GoogleChrome/custom-tabs-client">GoogleChrome/custom&#45;tabs&#45;client: Chrome custom tabs examples</a></p>
<p>ちょっとしたことだけど非常に反応が良くなるので customtabs を使うならぜひ利用したい</p>
<div class="entry-links"></div>
</section>
<footer class="entry-footer">
<span class="tag-links">タグ: <a href="https://www.yusukezzz.net/archives/tag/android" rel="tag">android</a>, <a href="https://www.yusukezzz.net/archives/tag/library" rel="tag">library</a></span>
</footer> 
</article>
<article id="post-90" class="post-90 post type-post status-publish format-standard hentry category-uncategorized tag-debug tag-java tag-jvisualvm">
<header>
<h2 class="entry-title"><a href="https://www.yusukezzz.net/archives/90" title="jvisualvm でリモート接続" rel="bookmark">jvisualvm でリモート接続</a></h2> <section class="entry-meta">
<span class="author vcard"><a href="https://www.yusukezzz.net/archives/author/yusukezzz" title="yusukezzz の投稿" rel="author">yusukezzz</a></span>
<span class="meta-sep"> | </span>
<span class="entry-date">2017-10-13</span>
</section>
</header>
<section class="entry-content">
<p>jdk をインストールすると付いてくる便利なプロファイラ jvisualvm でリモートサーバの java プロセスに接続する方法についての覚書</p>
<p>jvisualvm でリモート接続する方法は、<br />
jstatd（これも jdk 組み込み）という java プロセスの監視ツールを経由する方法と JMX という仕様を利用する方法の2種類がある<br />
今回はリモートサーバに jdk が入ってなかったので JMX でやる場合</p>
<h3>JMX 起動オプション</h3>
<p>リモートサーバで java アプリを起動する際に以下のオプションを指定しておく（以下は jdk8 の場合）<br />
port は他で使われてなければ何でも良いが、同じ値を指定する<br />
127.0.0.1 は環境に合わせて変える</p>
<pre><code>-Dcom.sun.management.jmxremote.port=3333
-Dcom.sun.management.jmxremote.rmi.port=3333
-Dcom.sun.management.jmxremote.ssl=false
-Dcom.sun.management.jmxremote.authenticate=false
-Djava.rmi.server.hostname=127.0.0.1
</code></pre>
<p>今回接続する際は ssh のポートフォワーディングを利用した<br />
<code>ssh -L 3333:127.0.0.1:3333 user@remote-server</code><br />
などでリモートへの接続を開いておき jvisualvm から localhost:3333 に対して繋ぐ</p>
<div class="entry-links"></div>
</section>
<footer class="entry-footer">
<span class="tag-links">タグ: <a href="https://www.yusukezzz.net/archives/tag/debug" rel="tag">debug</a>, <a href="https://www.yusukezzz.net/archives/tag/java" rel="tag">java</a>, <a href="https://www.yusukezzz.net/archives/tag/jvisualvm" rel="tag">jvisualvm</a></span>
</footer> 
</article>
<article id="post-84" class="post-84 post type-post status-publish format-standard hentry category-uncategorized tag-laravel tag-php">
<header>
<h2 class="entry-title"><a href="https://www.yusukezzz.net/archives/84" title="Laravel で .env の内容が反映されない場合" rel="bookmark">Laravel で .env の内容が反映されない場合</a></h2> <section class="entry-meta">
<span class="author vcard"><a href="https://www.yusukezzz.net/archives/author/yusukezzz" title="yusukezzz の投稿" rel="author">yusukezzz</a></span>
<span class="meta-sep"> | </span>
<span class="entry-date">2017-10-08</span>
</section>
</header>
<section class="entry-content">
<p><a href="https://laravel.com/docs/5.5/configuration#configuration-caching">公式マニュアル</a>にも記載があるが、<br />
Laravel アプリで <code>artisan config:cache</code> を行っていると .env を変更してもファイルの内容が反映されない<br />
また、アプリ内で env ヘルパー関数などから直接環境変数を参照しているとそもそも値が渡っていない<br />
下記実装を見ると分かるが、 config キャッシュ済みの場合はそもそも .env のロード自体がスキップされるため</p>
<p><a href="https://github.com/laravel/framework/blob/bd352a0d2ca93775fce8ef02365b03fc4fb8cbb0/src/Illuminate/Foundation/Bootstrap/LoadEnvironmentVariables.php#L20">framework/LoadEnvironmentVariables&#46;php#L20 at bd352a0d2ca93775fce8ef02365b03fc4fb8cbb0 · laravel/framework</a></p>
<p>解決するには config を cache しない、又は env の値を config ファイルを経由して参照するよう徹底し値の変更ごとに cache し直す</p>
<div class="entry-links"></div>
</section>
<footer class="entry-footer">
<span class="tag-links">タグ: <a href="https://www.yusukezzz.net/archives/tag/laravel" rel="tag">laravel</a>, <a href="https://www.yusukezzz.net/archives/tag/php" rel="tag">php</a></span>
</footer> 
</article>
<nav id="nav-below" class="navigation" role="navigation">
<div class="nav-previous"><a href="https://www.yusukezzz.net/page/2" ><span class="meta-nav">&larr;</span> 古い方へ</a></div>
<div class="nav-next"></div>
</nav>
</section>
</div>
<footer id="footer" role="contentinfo">
<div id="copyright">
&copy; 2017 yusukezzz weblog</div>
</footer>
</div>
<script>
  function loadCss(url) {
    var l = document.createElement('link'); l.rel = 'stylesheet'; l.href = url;
    var h = document.getElementsByTagName('head')[0]; h.parentNode.insertBefore(l, h);
  }
  function loadJs(url, cb) {
    var d = document, t = 'script',
        o = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    o.src = url;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }
  var cb = function() {
    loadCss('https://www.yusukezzz.net/wp-content/themes/writer/style.css');
    loadCss('https://www.yusukezzz.net/wp-content/highlightjs/solarized-light.css');
    loadJs('https://www.yusukezzz.net/wp-content/highlightjs/highlight.pack.js', function() {
      hljs.initHighlightingOnLoad();
    });
  };
  var raf = requestAnimationFrame || mozRequestAnimationFrame ||
      webkitRequestAnimationFrame || msRequestAnimationFrame;
  if (raf) raf(cb);
  else window.addEventListener('load', cb);
</script>
</body>
</html>